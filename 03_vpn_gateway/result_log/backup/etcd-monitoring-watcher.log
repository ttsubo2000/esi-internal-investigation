2018-04-15 23:58:02,532:DEBUG:New etcd client created for etcd-server:2379/v2
2018-04-15 23:58:02,533:DEBUG:About to wait on key /monitoring, index None
2018-04-15 23:58:02,533:DEBUG:Issuing read for key /monitoring with args {'recursive': True, 'timeout': None, 'wait': True}
2018-04-15 23:58:02,534:DEBUG:Starting new HTTP connection (1): etcd-server
2018-04-15 23:58:02,537:DEBUG:http://etcd-server:2379 "GET /v2/keys/monitoring?recursive=true&wait=true HTTP/1.1" 200 None
2018-04-16 00:00:29,899:DEBUG:
*** Consume stored data in etcd ***
 action=[set], key=[/monitoring/v2.0/ese_devices/4d8371c0-1b91-4818-a6e7-26425178e5d4],
 value=[{
    "switch": "UP", 
    "version": 1
}]
2018-04-16 00:00:29,899:DEBUG:New etcd client created for etcd-server:2379/v2
2018-04-16 00:00:29,900:DEBUG:About to wait on key /monitoring, index None
2018-04-16 00:00:29,900:DEBUG:Issuing read for key /monitoring with args {'recursive': True, 'timeout': None, 'wait': True}
2018-04-16 00:00:29,901:DEBUG:Starting new HTTP connection (1): etcd-server
2018-04-16 00:00:29,903:DEBUG:http://etcd-server:2379 "GET /v2/keys/monitoring?recursive=true&wait=true HTTP/1.1" 200 None
2018-04-16 00:01:37,621:DEBUG:
*** Consume stored data in etcd ***
 action=[set], key=[/monitoring/v2.0/ese_physical_ports/0078808a-c28e-46e1-887d-8ec65f90c446],
 value=[{
    "version": 1, 
    "port": "UP"
}]
2018-04-16 00:01:37,622:DEBUG:New etcd client created for etcd-server:2379/v2
2018-04-16 00:01:37,623:DEBUG:About to wait on key /monitoring, index None
2018-04-16 00:01:37,623:DEBUG:Issuing read for key /monitoring with args {'recursive': True, 'timeout': None, 'wait': True}
2018-04-16 00:01:37,624:DEBUG:Starting new HTTP connection (1): etcd-server
2018-04-16 00:01:37,626:DEBUG:http://etcd-server:2379 "GET /v2/keys/monitoring?recursive=true&wait=true HTTP/1.1" 200 None
2018-04-16 00:02:37,625:DEBUG:
*** Consume stored data in etcd ***
 action=[set], key=[/monitoring/v2.0/ese_physical_ports/a6e70af1-386b-4d79-943f-6f44e87f95b3],
 value=[{
    "version": 1, 
    "port": "UP"
}]
2018-04-16 00:02:37,625:DEBUG:New etcd client created for etcd-server:2379/v2
2018-04-16 00:02:37,626:DEBUG:About to wait on key /monitoring, index None
2018-04-16 00:02:37,626:DEBUG:Issuing read for key /monitoring with args {'recursive': True, 'timeout': None, 'wait': True}
2018-04-16 00:02:37,627:DEBUG:Starting new HTTP connection (1): etcd-server
2018-04-16 00:02:37,629:DEBUG:http://etcd-server:2379 "GET /v2/keys/monitoring?recursive=true&wait=true HTTP/1.1" 200 None
2018-04-16 00:03:42,578:DEBUG:
*** Consume stored data in etcd ***
 action=[set], key=[/monitoring/v2.0/edge_routers/7a35974a-a19f-49e2-b907-ad7fd8692975],
 value=[{
    "router": "UP", 
    "version": 1
}]
2018-04-16 00:03:42,578:DEBUG:New etcd client created for etcd-server:2379/v2
2018-04-16 00:03:42,579:DEBUG:About to wait on key /monitoring, index None
2018-04-16 00:03:42,579:DEBUG:Issuing read for key /monitoring with args {'recursive': True, 'timeout': None, 'wait': True}
2018-04-16 00:03:42,579:DEBUG:Starting new HTTP connection (1): etcd-server
2018-04-16 00:03:42,581:DEBUG:http://etcd-server:2379 "GET /v2/keys/monitoring?recursive=true&wait=true HTTP/1.1" 200 None
2018-04-16 00:04:46,801:DEBUG:
*** Consume stored data in etcd ***
 action=[set], key=[/monitoring/v2.0/edge_routers/b7e6d8ad-5377-4380-bbb4-1a62566cbd6d],
 value=[{
    "router": "UP", 
    "version": 1
}]
2018-04-16 00:04:46,801:DEBUG:New etcd client created for etcd-server:2379/v2
2018-04-16 00:04:46,802:DEBUG:About to wait on key /monitoring, index None
2018-04-16 00:04:46,802:DEBUG:Issuing read for key /monitoring with args {'recursive': True, 'timeout': None, 'wait': True}
2018-04-16 00:04:46,802:DEBUG:Starting new HTTP connection (1): etcd-server
2018-04-16 00:04:46,804:DEBUG:http://etcd-server:2379 "GET /v2/keys/monitoring?recursive=true&wait=true HTTP/1.1" 200 None
2018-04-16 00:05:53,479:DEBUG:
*** Consume stored data in etcd ***
 action=[set], key=[/monitoring/v2.0/er_physical_interfaces/f3ecf585-5c3b-445a-97a7-d8e124c99e16],
 value=[{
    "interface": "UP", 
    "version": 1
}]
2018-04-16 00:05:53,479:DEBUG:New etcd client created for etcd-server:2379/v2
2018-04-16 00:05:53,479:DEBUG:About to wait on key /monitoring, index None
2018-04-16 00:05:53,479:DEBUG:Issuing read for key /monitoring with args {'recursive': True, 'timeout': None, 'wait': True}
2018-04-16 00:05:53,480:DEBUG:Starting new HTTP connection (1): etcd-server
2018-04-16 00:05:53,481:DEBUG:http://etcd-server:2379 "GET /v2/keys/monitoring?recursive=true&wait=true HTTP/1.1" 200 None
2018-04-16 00:06:53,481:DEBUG:
*** Consume stored data in etcd ***
 action=[set], key=[/monitoring/v2.0/er_physical_interfaces/3118d6be-b1cb-472a-805f-7e1ec46aa5e7],
 value=[{
    "interface": "UP", 
    "version": 1
}]
2018-04-16 00:06:53,481:DEBUG:New etcd client created for etcd-server:2379/v2
2018-04-16 00:06:53,482:DEBUG:About to wait on key /monitoring, index None
2018-04-16 00:06:53,482:DEBUG:Issuing read for key /monitoring with args {'recursive': True, 'timeout': None, 'wait': True}
2018-04-16 00:06:53,482:DEBUG:Starting new HTTP connection (1): etcd-server
2018-04-16 00:06:53,484:DEBUG:http://etcd-server:2379 "GET /v2/keys/monitoring?recursive=true&wait=true HTTP/1.1" 200 None
2018-04-16 00:07:58,012:DEBUG:
*** Consume stored data in etcd ***
 action=[set], key=[/monitoring/v2.0/er_physical_interfaces/c8e2d558-02ee-4bf3-ba5b-958821a21043],
 value=[{
    "interface": "UP", 
    "version": 1
}]
2018-04-16 00:07:58,012:DEBUG:New etcd client created for etcd-server:2379/v2
2018-04-16 00:07:58,012:DEBUG:About to wait on key /monitoring, index None
2018-04-16 00:07:58,012:DEBUG:Issuing read for key /monitoring with args {'recursive': True, 'timeout': None, 'wait': True}
2018-04-16 00:07:58,013:DEBUG:Starting new HTTP connection (1): etcd-server
2018-04-16 00:07:58,015:DEBUG:http://etcd-server:2379 "GET /v2/keys/monitoring?recursive=true&wait=true HTTP/1.1" 200 None
2018-04-16 00:08:58,020:DEBUG:
*** Consume stored data in etcd ***
 action=[set], key=[/monitoring/v2.0/er_physical_interfaces/2bc8e40d-ab01-4738-a4aa-e69d8fd30688],
 value=[{
    "interface": "UP", 
    "version": 1
}]
2018-04-16 00:08:58,020:DEBUG:New etcd client created for etcd-server:2379/v2
2018-04-16 00:08:58,021:DEBUG:About to wait on key /monitoring, index None
2018-04-16 00:08:58,021:DEBUG:Issuing read for key /monitoring with args {'recursive': True, 'timeout': None, 'wait': True}
2018-04-16 00:08:58,024:DEBUG:Starting new HTTP connection (1): etcd-server
2018-04-16 00:08:58,028:DEBUG:http://etcd-server:2379 "GET /v2/keys/monitoring?recursive=true&wait=true HTTP/1.1" 200 None
2018-04-16 00:11:07,400:DEBUG:
*** Consume stored data in etcd ***
 action=[set], key=[/monitoring/v2.0/vpn_interfaces/07d4f1fc-5142-4fae-b115-627fc009e222],
 value=[{
    "status": {
        "primary": "ESTABLISHED", 
        "secondary": "ESTABLISHED"
    }, 
    "version": 1
}]
2018-04-16 00:11:07,401:DEBUG:New etcd client created for etcd-server:2379/v2
2018-04-16 00:11:07,401:DEBUG:About to wait on key /monitoring, index None
2018-04-16 00:11:07,401:DEBUG:Issuing read for key /monitoring with args {'recursive': True, 'timeout': None, 'wait': True}
2018-04-16 00:11:07,402:DEBUG:Starting new HTTP connection (1): etcd-server
2018-04-16 00:11:07,403:DEBUG:http://etcd-server:2379 "GET /v2/keys/monitoring?recursive=true&wait=true HTTP/1.1" 200 None
2018-04-16 00:13:47,334:DEBUG:
*** Consume stored data in etcd ***
 action=[set], key=[/monitoring/v2.0/gw_interfaces/3dbcfce5-bca5-4182-991a-c23de685fcf1],
 value=[{
    "status": {
        "primary": "MASTER", 
        "secondary": "BACKUP"
    }, 
    "version": 1
}]
2018-04-16 00:13:47,335:DEBUG:New etcd client created for etcd-server:2379/v2
2018-04-16 00:13:47,335:DEBUG:About to wait on key /monitoring, index None
2018-04-16 00:13:47,335:DEBUG:Issuing read for key /monitoring with args {'recursive': True, 'timeout': None, 'wait': True}
2018-04-16 00:13:47,336:DEBUG:Starting new HTTP connection (1): etcd-server
2018-04-16 00:13:47,339:DEBUG:http://etcd-server:2379 "GET /v2/keys/monitoring?recursive=true&wait=true HTTP/1.1" 200 None
2018-04-16 00:13:56,840:DEBUG:
*** Consume stored data in etcd ***
 action=[set], key=[/monitoring/v2.0/ese_logical_ports/257d0a9f-d5ae-4a93-9af4-81ad611e1b0d],
 value=[{
    "logical_port": "UP", 
    "version": 1
}]
2018-04-16 00:13:56,840:DEBUG:New etcd client created for etcd-server:2379/v2
2018-04-16 00:13:56,841:DEBUG:About to wait on key /monitoring, index None
2018-04-16 00:13:56,841:DEBUG:Issuing read for key /monitoring with args {'recursive': True, 'timeout': None, 'wait': True}
2018-04-16 00:13:56,841:DEBUG:Starting new HTTP connection (1): etcd-server
2018-04-16 00:13:56,845:DEBUG:http://etcd-server:2379 "GET /v2/keys/monitoring?recursive=true&wait=true HTTP/1.1" 200 None
2018-04-16 00:13:56,892:DEBUG:
*** Consume stored data in etcd ***
 action=[set], key=[/monitoring/v2.0/ese_logical_ports/e30fdd19-2f48-422e-9c68-7c59a0e2fae8],
 value=[{
    "logical_port": "UP", 
    "version": 1
}]
2018-04-16 00:13:56,893:DEBUG:New etcd client created for etcd-server:2379/v2
2018-04-16 00:13:56,893:DEBUG:About to wait on key /monitoring, index None
2018-04-16 00:13:56,893:DEBUG:Issuing read for key /monitoring with args {'recursive': True, 'timeout': None, 'wait': True}
2018-04-16 00:13:56,893:DEBUG:Starting new HTTP connection (1): etcd-server
2018-04-16 00:13:56,898:DEBUG:http://etcd-server:2379 "GET /v2/keys/monitoring?recursive=true&wait=true HTTP/1.1" 200 None
2018-04-16 00:14:04,286:DEBUG:
*** Consume stored data in etcd ***
 action=[set], key=[/monitoring/v2.0/ports/53eeb091-3297-4b9b-a200-b6568567e387],
 value=[{
    "version": 2, 
    "vmi": "FAIL"
}]
2018-04-16 00:14:04,286:DEBUG:New etcd client created for etcd-server:2379/v2
2018-04-16 00:14:04,286:DEBUG:About to wait on key /monitoring, index None
2018-04-16 00:14:04,286:DEBUG:Issuing read for key /monitoring with args {'recursive': True, 'timeout': None, 'wait': True}
2018-04-16 00:14:04,287:DEBUG:Starting new HTTP connection (1): etcd-server
2018-04-16 00:14:04,295:DEBUG:http://etcd-server:2379 "GET /v2/keys/monitoring?recursive=true&wait=true HTTP/1.1" 200 None
2018-04-16 00:14:04,312:DEBUG:
*** Consume stored data in etcd ***
 action=[set], key=[/monitoring/v2.0/ports/5eebab65-bf2f-4ac2-969a-15d6ccbfdd4b],
 value=[{
    "version": 2, 
    "vmi": "UP"
}]
2018-04-16 00:14:04,312:DEBUG:New etcd client created for etcd-server:2379/v2
2018-04-16 00:14:04,312:DEBUG:About to wait on key /monitoring, index None
2018-04-16 00:14:04,312:DEBUG:Issuing read for key /monitoring with args {'recursive': True, 'timeout': None, 'wait': True}
2018-04-16 00:14:04,313:DEBUG:Starting new HTTP connection (1): etcd-server
2018-04-16 00:14:04,315:DEBUG:http://etcd-server:2379 "GET /v2/keys/monitoring?recursive=true&wait=true HTTP/1.1" 200 None
2018-04-16 00:19:04,370:DEBUG:
*** Consume stored data in etcd ***
 action=[set], key=[/monitoring/v2.0/ports/53eeb091-3297-4b9b-a200-b6568567e387],
 value=[{
    "version": 2, 
    "vmi": "UP"
}]
2018-04-16 00:19:04,370:DEBUG:New etcd client created for etcd-server:2379/v2
2018-04-16 00:19:04,371:DEBUG:About to wait on key /monitoring, index None
2018-04-16 00:19:04,371:DEBUG:Issuing read for key /monitoring with args {'recursive': True, 'timeout': None, 'wait': True}
2018-04-16 00:19:04,372:DEBUG:Starting new HTTP connection (1): etcd-server
2018-04-16 00:19:04,378:DEBUG:http://etcd-server:2379 "GET /v2/keys/monitoring?recursive=true&wait=true HTTP/1.1" 200 None
2018-04-16 00:19:04,381:DEBUG:
*** Consume stored data in etcd ***
 action=[set], key=[/monitoring/v2.0/ports/5eebab65-bf2f-4ac2-969a-15d6ccbfdd4b],
 value=[{
    "version": 2, 
    "vmi": "FAIL"
}]
2018-04-16 00:19:04,382:DEBUG:New etcd client created for etcd-server:2379/v2
2018-04-16 00:19:04,382:DEBUG:About to wait on key /monitoring, index None
2018-04-16 00:19:04,383:DEBUG:Issuing read for key /monitoring with args {'recursive': True, 'timeout': None, 'wait': True}
2018-04-16 00:19:04,383:DEBUG:Starting new HTTP connection (1): etcd-server
2018-04-16 00:19:04,388:DEBUG:http://etcd-server:2379 "GET /v2/keys/monitoring?recursive=true&wait=true HTTP/1.1" 200 None
2018-04-16 00:20:32,129:ERROR:Request to server http://etcd-server:2379 failed: ProtocolError('Connection broken: IncompleteRead(0 bytes read)', IncompleteRead(0 bytes read))
2018-04-16 00:20:32,129:DEBUG:Reconnection disabled, giving up.
Traceback (most recent call last):
  File "/usr/local/lib/python2.7/dist-packages/eventlet/hubs/hub.py", line 346, in fire_timers
    timer()
  File "/usr/local/lib/python2.7/dist-packages/eventlet/hubs/timer.py", line 56, in __call__
    cb(*args, **kw)
  File "/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py", line 194, in main
    result = function(*args, **kwargs)
  File "/tools/etcd-watcher-for-esi/python-etcd-watch.py", line 15, in _consume_loop
    result = client.watch(key_info, recursive=True)
  File "/usr/local/lib/python2.7/dist-packages/etcd/client.py", line 655, in watch
    recursive=recursive)
  File "/usr/local/lib/python2.7/dist-packages/etcd/client.py", line 481, in read
    timeout=timeout)
  File "/usr/local/lib/python2.7/dist-packages/etcd/client.py", line 788, in api_execute
    cause=e
EtcdConnectionFailed: Connection to etcd failed due to ProtocolError('Connection broken: IncompleteRead(0 bytes read)', IncompleteRead(0 bytes read))
Traceback (most recent call last):
  File "/tools/etcd-watcher-for-esi/python-etcd-watch.py", line 48, in <module>
    thread.wait()
  File "/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py", line 168, in wait
    return self._exit_event.wait()
  File "/usr/local/lib/python2.7/dist-packages/eventlet/event.py", line 116, in wait
    return hubs.get_hub().switch()
  File "/usr/local/lib/python2.7/dist-packages/eventlet/hubs/hub.py", line 187, in switch
    return self.greenlet.switch()
  File "/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py", line 194, in main
    result = function(*args, **kwargs)
  File "/tools/etcd-watcher-for-esi/python-etcd-watch.py", line 15, in _consume_loop
    result = client.watch(key_info, recursive=True)
  File "/usr/local/lib/python2.7/dist-packages/etcd/client.py", line 655, in watch
    recursive=recursive)
  File "/usr/local/lib/python2.7/dist-packages/etcd/client.py", line 481, in read
    timeout=timeout)
  File "/usr/local/lib/python2.7/dist-packages/etcd/client.py", line 788, in api_execute
    cause=e
etcd.EtcdConnectionFailed: Connection to etcd failed due to ProtocolError('Connection broken: IncompleteRead(0 bytes read)', IncompleteRead(0 bytes read))
