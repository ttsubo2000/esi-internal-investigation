2018-04-09 04:40:19,988:DEBUG:New etcd client created for etcd-server:2379/v2
2018-04-09 04:40:19,988:DEBUG:About to wait on key /monitoring, index None
2018-04-09 04:40:19,988:DEBUG:Issuing read for key /monitoring with args {'recursive': True, 'timeout': None, 'wait': True}
2018-04-09 04:40:19,989:DEBUG:Starting new HTTP connection (1): etcd-server
2018-04-09 04:40:19,992:DEBUG:http://etcd-server:2379 "GET /v2/keys/monitoring?recursive=true&wait=true HTTP/1.1" 200 None
2018-04-09 04:42:23,250:DEBUG:
*** Consume stored data in etcd ***
 action=[set], key=[/monitoring/v2.0/ese_devices/cc214b6a-2f09-4094-b7cd-a9590f64b854],
 value=[{
    "switch": "UP", 
    "version": 1
}]
2018-04-09 04:42:23,251:DEBUG:New etcd client created for etcd-server:2379/v2
2018-04-09 04:42:23,251:DEBUG:About to wait on key /monitoring, index None
2018-04-09 04:42:23,251:DEBUG:Issuing read for key /monitoring with args {'recursive': True, 'timeout': None, 'wait': True}
2018-04-09 04:42:23,252:DEBUG:Starting new HTTP connection (1): etcd-server
2018-04-09 04:42:23,254:DEBUG:http://etcd-server:2379 "GET /v2/keys/monitoring?recursive=true&wait=true HTTP/1.1" 200 None
2018-04-09 04:43:30,699:DEBUG:
*** Consume stored data in etcd ***
 action=[set], key=[/monitoring/v2.0/ese_physical_ports/9451c9ca-289d-42ba-846d-359c448e910c],
 value=[{
    "version": 1, 
    "port": "UP"
}]
2018-04-09 04:43:30,700:DEBUG:New etcd client created for etcd-server:2379/v2
2018-04-09 04:43:30,700:DEBUG:About to wait on key /monitoring, index None
2018-04-09 04:43:30,700:DEBUG:Issuing read for key /monitoring with args {'recursive': True, 'timeout': None, 'wait': True}
2018-04-09 04:43:30,701:DEBUG:Starting new HTTP connection (1): etcd-server
2018-04-09 04:43:30,705:DEBUG:http://etcd-server:2379 "GET /v2/keys/monitoring?recursive=true&wait=true HTTP/1.1" 200 None
2018-04-09 04:44:30,705:DEBUG:
*** Consume stored data in etcd ***
 action=[set], key=[/monitoring/v2.0/ese_physical_ports/f4c3a1bf-3b61-48ba-a548-422036849465],
 value=[{
    "version": 1, 
    "port": "UP"
}]
2018-04-09 04:44:30,705:DEBUG:New etcd client created for etcd-server:2379/v2
2018-04-09 04:44:30,705:DEBUG:About to wait on key /monitoring, index None
2018-04-09 04:44:30,705:DEBUG:Issuing read for key /monitoring with args {'recursive': True, 'timeout': None, 'wait': True}
2018-04-09 04:44:30,706:DEBUG:Starting new HTTP connection (1): etcd-server
2018-04-09 04:44:30,708:DEBUG:http://etcd-server:2379 "GET /v2/keys/monitoring?recursive=true&wait=true HTTP/1.1" 200 None
2018-04-09 04:45:35,383:DEBUG:
*** Consume stored data in etcd ***
 action=[set], key=[/monitoring/v2.0/edge_routers/f4f54175-93fe-406b-ae66-dbca4df99e03],
 value=[{
    "router": "UP", 
    "version": 1
}]
2018-04-09 04:45:35,383:DEBUG:New etcd client created for etcd-server:2379/v2
2018-04-09 04:45:35,383:DEBUG:About to wait on key /monitoring, index None
2018-04-09 04:45:35,384:DEBUG:Issuing read for key /monitoring with args {'recursive': True, 'timeout': None, 'wait': True}
2018-04-09 04:45:35,384:DEBUG:Starting new HTTP connection (1): etcd-server
2018-04-09 04:45:35,386:DEBUG:http://etcd-server:2379 "GET /v2/keys/monitoring?recursive=true&wait=true HTTP/1.1" 200 None
2018-04-09 04:46:39,529:DEBUG:
*** Consume stored data in etcd ***
 action=[set], key=[/monitoring/v2.0/edge_routers/2d056865-47a9-45cf-a890-ed10e3b5912a],
 value=[{
    "router": "UP", 
    "version": 1
}]
2018-04-09 04:46:39,529:DEBUG:New etcd client created for etcd-server:2379/v2
2018-04-09 04:46:39,529:DEBUG:About to wait on key /monitoring, index None
2018-04-09 04:46:39,529:DEBUG:Issuing read for key /monitoring with args {'recursive': True, 'timeout': None, 'wait': True}
2018-04-09 04:46:39,530:DEBUG:Starting new HTTP connection (1): etcd-server
2018-04-09 04:46:39,532:DEBUG:http://etcd-server:2379 "GET /v2/keys/monitoring?recursive=true&wait=true HTTP/1.1" 200 None
2018-04-09 04:47:45,715:DEBUG:
*** Consume stored data in etcd ***
 action=[set], key=[/monitoring/v2.0/er_physical_interfaces/c2576120-00b0-461e-a2ae-f7bbff9465d0],
 value=[{
    "interface": "UP", 
    "version": 1
}]
2018-04-09 04:47:45,715:DEBUG:New etcd client created for etcd-server:2379/v2
2018-04-09 04:47:45,715:DEBUG:About to wait on key /monitoring, index None
2018-04-09 04:47:45,715:DEBUG:Issuing read for key /monitoring with args {'recursive': True, 'timeout': None, 'wait': True}
2018-04-09 04:47:45,716:DEBUG:Starting new HTTP connection (1): etcd-server
2018-04-09 04:47:45,718:DEBUG:http://etcd-server:2379 "GET /v2/keys/monitoring?recursive=true&wait=true HTTP/1.1" 200 None
2018-04-09 04:48:50,092:DEBUG:
*** Consume stored data in etcd ***
 action=[set], key=[/monitoring/v2.0/er_physical_interfaces/b9c7c1f4-1b90-4a7a-8161-34276bb2ed10],
 value=[{
    "interface": "UP", 
    "version": 1
}]
2018-04-09 04:48:50,092:DEBUG:New etcd client created for etcd-server:2379/v2
2018-04-09 04:48:50,092:DEBUG:About to wait on key /monitoring, index None
2018-04-09 04:48:50,093:DEBUG:Issuing read for key /monitoring with args {'recursive': True, 'timeout': None, 'wait': True}
2018-04-09 04:48:50,093:DEBUG:Starting new HTTP connection (1): etcd-server
2018-04-09 04:48:50,096:DEBUG:http://etcd-server:2379 "GET /v2/keys/monitoring?recursive=true&wait=true HTTP/1.1" 200 None
2018-04-09 04:51:07,839:DEBUG:
*** Consume stored data in etcd ***
 action=[set], key=[/monitoring/v2.0/ese_logical_ports/e8555ee6-529c-42d9-8bb1-bfbe217133b1],
 value=[{
    "logical_port": "UP", 
    "version": 1
}]
2018-04-09 04:51:07,839:DEBUG:New etcd client created for etcd-server:2379/v2
2018-04-09 04:51:07,840:DEBUG:About to wait on key /monitoring, index None
2018-04-09 04:51:07,840:DEBUG:Issuing read for key /monitoring with args {'recursive': True, 'timeout': None, 'wait': True}
2018-04-09 04:51:07,841:DEBUG:Starting new HTTP connection (1): etcd-server
2018-04-09 04:51:07,846:DEBUG:http://etcd-server:2379 "GET /v2/keys/monitoring?recursive=true&wait=true HTTP/1.1" 200 None
2018-04-09 04:51:08,574:DEBUG:
*** Consume stored data in etcd ***
 action=[set], key=[/monitoring/v2.0/ese_logical_ports/be66c7e0-b222-4e76-bf81-af75e8cf1824],
 value=[{
    "logical_port": "UP", 
    "version": 1
}]
2018-04-09 04:51:08,575:DEBUG:New etcd client created for etcd-server:2379/v2
2018-04-09 04:51:08,575:DEBUG:About to wait on key /monitoring, index None
2018-04-09 04:51:08,575:DEBUG:Issuing read for key /monitoring with args {'recursive': True, 'timeout': None, 'wait': True}
2018-04-09 04:51:08,575:DEBUG:Starting new HTTP connection (1): etcd-server
2018-04-09 04:51:08,578:DEBUG:http://etcd-server:2379 "GET /v2/keys/monitoring?recursive=true&wait=true HTTP/1.1" 200 None
2018-04-09 04:51:20,456:DEBUG:
*** Consume stored data in etcd ***
 action=[set], key=[/monitoring/v2.0/common_function_gateways/f649736d-1920-41eb-96af-d4e4fe192d0e],
 value=[{
    "status": {
        "secondary_vrid1": "BACKUP", 
        "secondary_vrid2": "BACKUP", 
        "primary_vrid2": "MASTER", 
        "primary_vrid1": "MASTER"
    }, 
    "version": 1
}]
2018-04-09 04:51:20,456:DEBUG:New etcd client created for etcd-server:2379/v2
2018-04-09 04:51:20,456:DEBUG:About to wait on key /monitoring, index None
2018-04-09 04:51:20,456:DEBUG:Issuing read for key /monitoring with args {'recursive': True, 'timeout': None, 'wait': True}
2018-04-09 04:51:20,457:DEBUG:Starting new HTTP connection (1): etcd-server
2018-04-09 04:51:20,458:DEBUG:http://etcd-server:2379 "GET /v2/keys/monitoring?recursive=true&wait=true HTTP/1.1" 200 None
2018-04-09 04:51:28,479:DEBUG:
*** Consume stored data in etcd ***
 action=[set], key=[/monitoring/v2.0/ports/343b0257-512e-40e3-b063-8cc13a4b61f4],
 value=[{
    "version": 2, 
    "vmi": "UP"
}]
2018-04-09 04:51:28,480:DEBUG:New etcd client created for etcd-server:2379/v2
2018-04-09 04:51:28,480:DEBUG:About to wait on key /monitoring, index None
2018-04-09 04:51:28,480:DEBUG:Issuing read for key /monitoring with args {'recursive': True, 'timeout': None, 'wait': True}
2018-04-09 04:51:28,480:DEBUG:Starting new HTTP connection (1): etcd-server
2018-04-09 04:51:28,484:DEBUG:http://etcd-server:2379 "GET /v2/keys/monitoring?recursive=true&wait=true HTTP/1.1" 200 None
2018-04-09 04:51:28,499:DEBUG:
*** Consume stored data in etcd ***
 action=[set], key=[/monitoring/v2.0/ports/f84496b5-dc56-4727-87b1-aa06e2471737],
 value=[{
    "version": 2, 
    "vmi": "FAIL"
}]
2018-04-09 04:51:28,499:DEBUG:New etcd client created for etcd-server:2379/v2
2018-04-09 04:51:28,499:DEBUG:About to wait on key /monitoring, index None
2018-04-09 04:51:28,499:DEBUG:Issuing read for key /monitoring with args {'recursive': True, 'timeout': None, 'wait': True}
2018-04-09 04:51:28,500:DEBUG:Starting new HTTP connection (1): etcd-server
2018-04-09 04:51:28,501:DEBUG:http://etcd-server:2379 "GET /v2/keys/monitoring?recursive=true&wait=true HTTP/1.1" 200 None
2018-04-09 04:52:28,513:DEBUG:
*** Consume stored data in etcd ***
 action=[set], key=[/monitoring/v2.0/ports/f84496b5-dc56-4727-87b1-aa06e2471737],
 value=[{
    "version": 2, 
    "vmi": "UP"
}]
2018-04-09 04:52:28,514:DEBUG:New etcd client created for etcd-server:2379/v2
2018-04-09 04:52:28,514:DEBUG:About to wait on key /monitoring, index None
2018-04-09 04:52:28,514:DEBUG:Issuing read for key /monitoring with args {'recursive': True, 'timeout': None, 'wait': True}
2018-04-09 04:52:28,515:DEBUG:Starting new HTTP connection (1): etcd-server
2018-04-09 04:52:28,518:DEBUG:http://etcd-server:2379 "GET /v2/keys/monitoring?recursive=true&wait=true HTTP/1.1" 200 None
2018-04-09 04:52:28,524:DEBUG:
*** Consume stored data in etcd ***
 action=[set], key=[/monitoring/v2.0/ports/343b0257-512e-40e3-b063-8cc13a4b61f4],
 value=[{
    "version": 2, 
    "vmi": "FAIL"
}]
2018-04-09 04:52:28,528:DEBUG:New etcd client created for etcd-server:2379/v2
2018-04-09 04:52:28,528:DEBUG:About to wait on key /monitoring, index None
2018-04-09 04:52:28,528:DEBUG:Issuing read for key /monitoring with args {'recursive': True, 'timeout': None, 'wait': True}
2018-04-09 04:52:28,528:DEBUG:Starting new HTTP connection (1): etcd-server
2018-04-09 04:52:28,530:DEBUG:http://etcd-server:2379 "GET /v2/keys/monitoring?recursive=true&wait=true HTTP/1.1" 200 None
2018-04-09 04:56:56,977:ERROR:Request to server http://etcd-server:2379 failed: ProtocolError('Connection broken: IncompleteRead(0 bytes read)', IncompleteRead(0 bytes read))
2018-04-09 04:56:56,978:DEBUG:Reconnection disabled, giving up.
Traceback (most recent call last):
  File "/usr/local/lib/python2.7/dist-packages/eventlet/hubs/hub.py", line 346, in fire_timers
    timer()
  File "/usr/local/lib/python2.7/dist-packages/eventlet/hubs/timer.py", line 56, in __call__
    cb(*args, **kw)
  File "/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py", line 194, in main
    result = function(*args, **kwargs)
  File "/tools/etcd-watcher-for-esi/python-etcd-watch.py", line 15, in _consume_loop
    result = client.watch(key_info, recursive=True)
  File "/usr/local/lib/python2.7/dist-packages/etcd/client.py", line 655, in watch
    recursive=recursive)
  File "/usr/local/lib/python2.7/dist-packages/etcd/client.py", line 481, in read
    timeout=timeout)
  File "/usr/local/lib/python2.7/dist-packages/etcd/client.py", line 788, in api_execute
    cause=e
EtcdConnectionFailed: Connection to etcd failed due to ProtocolError('Connection broken: IncompleteRead(0 bytes read)', IncompleteRead(0 bytes read))
Traceback (most recent call last):
  File "/tools/etcd-watcher-for-esi/python-etcd-watch.py", line 48, in <module>
    thread.wait()
  File "/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py", line 168, in wait
    return self._exit_event.wait()
  File "/usr/local/lib/python2.7/dist-packages/eventlet/event.py", line 116, in wait
    return hubs.get_hub().switch()
  File "/usr/local/lib/python2.7/dist-packages/eventlet/hubs/hub.py", line 187, in switch
    return self.greenlet.switch()
  File "/usr/local/lib/python2.7/dist-packages/eventlet/greenthread.py", line 194, in main
    result = function(*args, **kwargs)
  File "/tools/etcd-watcher-for-esi/python-etcd-watch.py", line 15, in _consume_loop
    result = client.watch(key_info, recursive=True)
  File "/usr/local/lib/python2.7/dist-packages/etcd/client.py", line 655, in watch
    recursive=recursive)
  File "/usr/local/lib/python2.7/dist-packages/etcd/client.py", line 481, in read
    timeout=timeout)
  File "/usr/local/lib/python2.7/dist-packages/etcd/client.py", line 788, in api_execute
    cause=e
etcd.EtcdConnectionFailed: Connection to etcd failed due to ProtocolError('Connection broken: IncompleteRead(0 bytes read)', IncompleteRead(0 bytes read))
